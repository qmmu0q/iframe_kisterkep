<!DOCTYPE html>
<html>
	<head>
		<meta charset = 'utf-8'>
		<meta name = 'viewport' content = 'initial-scale=1,user-scalable=no'/>

		<!--LEAFLET 1.9.4-->
		<link rel = 'stylesheet' href = 'leaflet/leaflet.css' />
		<script src = 'leaflet/leaflet.js'></script>

		<style>
			html, body {
                height: 100%;
				width: 100%;
                margin: 0;
            }
            #map_div {
                height: 100%;
				width: 100%;
            }
			svg path.kcsvonalak:hover {
				stroke-width: 7;
				stroke: #00A7E1;
			}
			path.leaflet-interactive:focus {
				outline: none;
			}
			.leaflet-container {
    background-color: red;
}
		</style>
	</head>



	<body>
		<div id = 'map_div'>
		</div>
		
		<script>
			//TÉRKÉPVÁSZON
			var map = L.map('map_div', {
				zoomSnap: 0,
				zoomControl: false,
				dragging: false,
				touchZoom: false,
				scrollWheelZoom: false,
				doubleClickZoom: false,
				boxZoom: false,
				keyboard: false
			});

			//ALAPTÉRKÉP
			var imageBounds = [
				[45.6648759935, 15.9442902088],
				[48.6559554141, 23.0638046802]
			];
			var imageOverlay = L.imageOverlay('media/basemap/basemap2.jpg', imageBounds).addTo(map);
			map.fitBounds(imageBounds);
			map.setZoom(map.getZoom() );

			
			//PONTRÉTEG
			var defaultIcon = L.icon({
				iconUrl: 'media/icon_default.png',
				iconSize: [16]
			});
			var highlightedIcon = L.icon({
				iconUrl: 'media/icon_highlighted.png',
				iconSize: [22]
			});
			var clickedPoints = [];
			fetch('geojson/pontok_iframe.geojson').then(r => r.json()).then(function (kcspontokJSON) {
				var kcspontokLayer = L.geoJson(kcspontokJSON, {pointToLayer: function (feature, latlng) {
					var coordinates = feature.geometry.coordinates;
					if (feature.geometry.type === 'MultiPoint') {
						var uniqueCoordinates = [];
						var reversedCoordinates = [];
						var filteredCoordinates = coordinates.filter(function (coord) {
							var coordString = coord.join(',');
							if (!uniqueCoordinates.includes(coordString)) { 
							uniqueCoordinates.push(coordString); 
							reversedCoordinates.push(coord.slice().reverse());
							return true; 
							};
							return false; 
						});
						var multipointGroup = L.featureGroup();
						filteredCoordinates.forEach(function (_, index) {
							var kcspontokFeature = L.marker(reversedCoordinates[index], { icon: defaultIcon });
							multipointGroup.addLayer(kcspontokFeature);
							kcspontokFeature.on('click', function (e) {			
								clickedPoints.forEach(function (point) {
									point.setIcon(defaultIcon);
								});
								clickedPoints = [];
								filteredCoordinates.forEach(function (_, i) {
									var part = multipointGroup.getLayers()[i];
									part.setIcon(highlightedIcon);
									clickedPoints.push(part); 
								});

								selected_kcsvonalak.setStyle({weight: 4, color: '#002557'});
							});
							kcspontokFeature.on('mouseover', function (e) {
								if (clickedPoints.indexOf(this) === -1) {
									filteredCoordinates.forEach(function (_, i) {
										var part = multipointGroup.getLayers()[i];
										part.setIcon(highlightedIcon);
									});
								}
							});
							kcspontokFeature.on('mouseout', function (e) {
								if (clickedPoints.indexOf(this) === -1) {
									filteredCoordinates.forEach(function (_, i) {
										var part = multipointGroup.getLayers()[i];
										part.setIcon(defaultIcon);
									});
								}
							});
							map.on('click', function (e) {
								clickedPoints.forEach(function (point) {
									point.setIcon(defaultIcon);
								});
								clickedPoints = [];
							});
						});
						return multipointGroup;
					};
				}});
				kcspontokLayer.addTo(map);
			});

			//VONALRÉTEG
			var selected_kcsvonalak; 
			fetch('geojson/vonalak_iframe.geojson').then(r => r.json()).then(function(kcsvonalakJSON) {
				var kcsvonalakLayer = L.geoJson(kcsvonalakJSON, {
					className: 'kcsvonalak', 
					color: '#002557', 
					weight: 4 
				}).addTo(map); 
				kcsvonalakLayer.on('click', function(e) {
					L.DomEvent.stopPropagation(e); 
					if (selected_kcsvonalak) {
						e.target.resetStyle(selected_kcsvonalak);
					};
					selected_kcsvonalak = e.layer; 
					selected_kcsvonalak.setStyle({ 
						color: '#00A7E1', 
						weight: 7
					});
					clickedPoints.forEach(function (point) {
						point.setIcon(defaultIcon); 
						clickedPoints = []; 
					});	
				});
				kcsvonalakLayer.eachLayer(function(kcsvonalakFeature) { 
					map.on('click', function() {
						kcsvonalakFeature.setStyle({
							weight: 4, 
							color: '#002557'
						});
					});
				});
			});
		</script>
	</body>
</html>